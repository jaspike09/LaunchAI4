<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase (Same credentials as auth.js)
        const SUPABASE_URL = 'https://yvgzyymjymrgjhhthgtj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2Z3p5eW1qeW1yZ2poaHRoZ3RqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5OTc1MzIsImV4cCI6MjA4NTU3MzUzMn0.814FVde267XILaw-VA76Yuk6Y6BVQpCr_5fAF2KtBFw';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. Data Setup
        localStorage.setItem('isSubscribed', 'true');
        const savedIdea = localStorage.getItem('userBusinessIdea');
        if (savedIdea) {
            document.getElementById('currentIdea').innerText = `"${savedIdea}"`;
        }

        const video = document.getElementById('mentorVideo');
        const playGate = document.getElementById('playGate');
        const startBtn = document.getElementById('startBriefing');
        const dashBtn = document.getElementById('dashboardBtn');

        // 2. Interaction Logic
        startBtn.addEventListener('click', () => {
            playGate.style.opacity = '0';
            setTimeout(() => playGate.classList.add('hidden'), 500);
            video.muted = false;
            video.play();
            
            setTimeout(() => {
                dashBtn.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
            }, 5000);
        });

        // 3. Permanent Sync on Exit
        dashBtn.addEventListener('click', async (e) => {
            // Optional: Sync subscription status to Supabase before leaving
            const { data: { user } } = await _supabase.auth.getUser();
            if (user) {
                await _supabase.from('profiles').update({ is_paid: true }).eq('id', user.id);
            }
        });

        video.onended = () => {
            dashBtn.classList.add('animate-pulse');
            dashBtn.innerHTML = 'Enter Mission Control <i class="fa-solid fa-rocket ml-2"></i>';
        };
    </script>
